<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NODEJS: TASK_5</title>
    <link rel="stylesheet" href="assets/fonts.css">
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/darcula.css">
</head>
<body>

<section class="header">
    <div class="header__content">
        <div class="header__subject">Auth</div>
        <div class="header__id">node_5</div>
    </div>
</section>

<section class="task">
    <div class="task__statement">
        Create a repository on Github <span class="task__inline-code">node_4</span>, clone it, open it in IDE
    </div>

    <div class="task__statement">
        We transfer our previous project node_3 into it.
    </div>

    <div class="task__statement">
        Let's install the libraries <a class="task__link" href="https://www.npmjs.com/package/jsonwebtoken"
                                       target="_blank">jsonwebtoken</a> and <a class="task__link"
                                                                               href="https://www.npmjs.com/package/bcryptjs"
                                                                               target="_blank">bcryptjs</a>
    </div>
</section>

<section class="task">
    <div class="task__statement">
        Let's add a list for storing users (<span class="task__inline-code">manager</span>) to our application
        <pre><code class="task__code json">"id": int
"email": string
"password": string
"super": boolean
</code></pre>
    </div>
</section>

<section class="task">
    <div class="task__statement">
        Add methods to the API:<br><br>
        <span class="task__inline-code">POST /api/auth/register</span> - accepts email and password and creates a record
        in the table managers / password must be stored in hashed form (use bcrypt)
        <br><br>
        <span class="task__inline-code">POST /api/auth/login</span> - accepts email and password and attempts to
        authenticate the manager / in if successful, returns a token created using jwt.sign with the manager's id and
        email embedded / token lifetime is 5 minutes
    </div>
</section>

<section class="task">
    <div class="task__statement">
        Let's create middleware that will for all API requests except <span class="task__inline-code">/api/auth/*</span>
        check for the presence of the header in the request <span class="task__inline-code">Authorization</span>.
    </div>

    <div class="task__statement">
        If this header is missing, return error 401.
    </div>

    <div class="task__statement">
        If the header is present, we check its validity using jwt.verify.
    </div>
    <div class="task__statement">
        If the token is valid, we load the user by id from the token and place it in <span class="task__inline-code">request.user</span>
    </div>

    <div class="task__statement">
        If the token is not valid or the user is not found, return error 403.
    </div>

    <div class="task__statement task__statement_note">
        The title must contain the word <span class=" task__inline-code">Bearer</span>. That is, the full title looks
        like this <span class="task__inline-code">Authorization: Bearer Token</span>
    </div>

    <section class="task">
        <div class="task__statement">
            Let's supplement the existing API methods as follows:
            <br><br>
            <span class="task__inline-code">READ operations</span> - available to a simple user and superuser / for
            others, error 403
            <br><br>
            <span class="task__inline-code">CREATE/ UPDATE/DELETE operations</span> - only available to superuser / for
            others, error 403
        </div>
    </section>
</section>

<section class="task">
    <div class="task__statement">
        Synchronize the local repository with the remote one (let's push to Github)
    </div>
</section>

<section class="task task_questions">
    <div class="task__statement">
        <input class="task__checkbox" type="checkbox">
        <span>
Drop a link to the GitHub repository.
</span>
    </div>

    <div class="task__statement">
        <input class="task__checkbox" type="checkbox">
        <span>
Demonstrate server operation via Postman (drop screenshots)
</span>
    </div>
</section>

<section class="task task_extras">
    <div class="task__statement">
        <a class="task__link" target="_blank" href="http://expressjs.com/en/4x/api.html ">Express Documentation</a>
    </div>
</section>

<section class="solution">
    <pre><code class="javascript"></code></pre>
</section>

<script src="assets/jquery-3.2.1.min.js"></script>
<script src="assets/highlight.pack.js"></script>
<script src="assets/script.js"></script>
</body>
</html>