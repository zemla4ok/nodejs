<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>07</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/yandex.css" id="theme">
    <link rel="stylesheet" href="../lib/css/zenburn.css">
    <link rel="stylesheet" href="../css/user.css">
</head>
<body class="yandex nodejs"><div class="reveal"><div class="slides">

    <section class="large">
        <h2>Node.js</h2>
        <p class="author">
            <small>Lecture 03</small>
        </p>
    </section>

    <section>
        <h4>HTTP. CORS. REST</h4>
    </section>

    <section>
        <h4>HTTP</h4>

        <ul>
            <li class="left fragment">Hypertext Transfer Protocol </li>
            <li class="left fragment">Tim Berners-Lee, CERN, 1989</li>
            <li class="left fragment">Application level protocol</li>
            <li class="left fragment">80 port</li>
            <li class="left fragment">request-response</li>
            <li class="left fragment">stateless</li>
            <li class="left fragment">TCP, possible to use UDP (HTTPU)</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - versioning</h4>

        <ul>
            <li class="left fragment">HTTP V0.9, 1991</li>
            <li class="left fragment">only GET</li>
            <li class="left fragment">only HTML</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - versioning</h4>

        <ul>
            <li class="left fragment">HTTP V1.0, 1996</li>
            <li class="left fragment">Content: images, video, text and other</li>
            <li class="left fragment">+ POST, HEAD</li>
            <li class="left fragment">status codes</li>
            <li class="left fragment">caching, authorisation</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - versioning</h4>

        <ul>
            <li class="left fragment">HTTP V1.1, 1999</li>
            <li class="left fragment">+ OPTIONS, PUT, DELETE, TRACE, CONNECT</li>
            <li class="left fragment">Connection: Keep-Alive</li>
            <li class="left fragment">possible to make batch of requests</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - Methods</h4>

        <ul>
            <li class="left">GET</li>
            <li class="left">POST</li>
            <li class="left">PUT</li>
            <li class="left">DELETE</li>
            <li class="left">HEAD</li>
            <li class="left">OPTIONS</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - GET</h4>

        <ul>
            <li class="left fragment">Request data</li>
            <li class="left fragment">no any side effects</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - HEAD</h4>

        <ul>
            <li class="left fragment">same as GET</li>
            <li class="left fragment">without body</li>
            <li class="left fragment">only headers</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - POST</h4>

        <ul>
            <li class="left fragment">create resource on the server side</li>
            <li class="left fragment">data in request body</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - PUT</h4>

        <ul>
            <li class="left fragment">request for updating resource on server side</li>
            <li class="left fragment">possible to create resource on the server side(decides by the server)</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - DELETE</h4>

        <ul>
            <li class="left fragment">delete resource on the server side</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - OPTIONS</h4>

        <ul>
            <li class="left fragment">get supported methods for URL</li>
            <li class="left fragment">CORS preflight</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - idempotency</h4>

        <ul>
            <li class="left fragment">amount of requests do not affect on result</li>
            <li class="left fragment">+: GET, HEAD, OPTIONS, PUT, DELETE</li>
            <li class="left fragment">-: POST</li>
            <li class="left fragment">depends on implementation</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - Request</h4>

        <ul>
            <li class="left fragment">request line</li>
            <li class="left fragment">headers</li>
            <li class="left fragment">empty string</li>
            <li class="left fragment">body</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - Request</h4>

        <pre class="javascript"><code>
GET /index.html HTTP/1.1
User-Agent: Mozilla/4.0 (compatible; MSIE5.01; Windows NT)
Host: www.example.com
Accept-Encoding: gzip, deflate
Connection: Keep-Alive
    </code></pre>
    </section>

    <section>
        <h4>HTTP - Response</h4>

        <ul>
            <li class="left fragment">status</li>
            <li class="left fragment">headers</li>
            <li class="left fragment">empty string</li>
            <li class="left fragment">body</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - Response</h4>

        <pre class="javascript"><code>
HTTP/1.1 200 OK
Date: Mon, 23 May 2005 22:38:34 GMT
Content-Type: text/html; charset=UTF-8
Content-Encoding: UTF-8
Content-Length: 138
Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
Server: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)
ETag: "3f80f-1b6-3e1cb03b"
Accept-Ranges: bytes
Connection: close

...
    </code></pre>
    </section>

    <section>
        <h4>HTTP - Statuses</h4>

        <ul>
            <li class="left fragment">1хх - informational</li>
            <li class="left fragment">2хх - success</li>
            <li class="left fragment">3хх - redirects</li>
            <li class="left fragment">4хх - client error</li>
            <li class="left fragment">5хх - server error</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - 2хх</h4>

        <ul>
            <li class="left fragment">200 - OK</li>
            <li class="left fragment">201 - Created</li>
            <li class="left fragment">202 - Accepted</li>
            <li class="left fragment">204 - No Content</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - 3хх</h4>

        <ul>
            <li class="left fragment">301 - Moved permanently</li>
            <li class="left fragment">302 - Moved Temporarily</li>
            <li class="left fragment">304 - Not Modified</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - 4хх</h4>

        <ul>
            <li class="left fragment">400 - Bad request</li>
            <li class="left fragment">401 - Unauthorized</li>
            <li class="left fragment">403 - Forbidden</li>
            <li class="left fragment">404 - Not Found</li>
            <li class="left fragment">405 - Method Not Allowed</li>
            <li class="left fragment">409 - Conflict</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - 5хх</h4>

        <ul>
            <li class="left fragment">500 - Internal Server Error</li>
            <li class="left fragment">503 - Service Unavailable</li>
            <li class="left fragment">504 - Gateway Timeout</li>
        </ul>
    </section>

    <section>
        <h4>HTTP - Caching</h4>

        <img src="images/no-cache.png">
    </section>

    <section>
        <h4>HTTP - Caching</h4>

        <img class="fullscreen" src="images/last-modified.png">
    </section>

    <section>
        <h4>HTTP - Caching</h4>

        <img class="fullscreen" src="images/etag.png">
    </section>

    <section>
        <h4>HTTP - Caching</h4>

        <img class="fullscreen" src="images/expires.png">
    </section>

    <section>
        <h4>HTTP - Caching</h4>

        <img  class="fullscreen" src="images/max-age.png">
    </section>

    <section>
        <h3><span class="red">A</span>ccess Policy</h3>
    </section>

    <section>
        <h4>Same origin policy</h4>

        <ul>
            <li class="left fragment">scripts of one tab can't access another tabs</li>
            <li class="left fragment">overlap of domain, port, protocol</li>
        </ul>
    </section>

    <section>
        <h4>CORS</h4>

        <pre class="javascript"><code>
GET /cors.txt HTTP/1.1
Host: z.com
Origin: a.com
    </code></pre>

        <pre class="javascript fragment"><code>
Access-Control-Allow-Origin:
  http://a.com
  http://b.com
  http://c.com
    </code></pre>

        <pre class="javascript fragment"><code>
Access-Control-Allow-Origin: *
    </code></pre>
    </section>

    <section>
        <h4>Cross-origin resource sharing</h4>

        <ul>
            <li class="left fragment">browser attaches to requests - Origin, Referer</li>
            <li class="left fragment">server can reject</li>
        </ul>
    </section>

    <section>
        <h4>CORS - Simple Request</h4>

        <ul>
            <li class="left fragment">without preflight</li>
            <li class="left fragment">if any Allow header is wrong -> response will be blocked</li>
            <li class="left fragment">Methods - GET, HEAD, POST</li>
            <li class="left fragment">Headers - Accept, Accept-Language, Content-Language, Content-Type</li>
        </ul>
    </section>

    <section>
        <h4>CORS - Preflight Request</h4>

        <ul>
            <li class="left fragment">make preflight / OPTIONS</li>
            <li class="left fragment">browser checks Allow headers</li>
        </ul>
    </section>

    <section>
        <h4>CORS - Allow Headers</h4>

        <ul>
            <li class="left fragment">Access-Control-Allow-Origin - allowed domains</li>
            <li class="left fragment">Access-Control-Allow-Headers - allowed headers</li>
            <li class="left fragment">Access-Control-Allow-Methods - allowed methods</li>
            <li class="left fragment">Access-Control-Expose-Headers - allowed to read headers</li>
        </ul>
    </section>

    <section>
        <h3><span class="red">H</span>TTPS</h3>
    </section>

    <section>
        <h4>HTTPS</h4>

        <ul>
            <li class="left fragment">HyperText Transfer Protocol Secure</li>
            <li class="left fragment">HTTP via TLS</li>
            <li class="left fragment">443 port</li>
        </ul>
    </section>

    <section>
        <h4>HTTPS</h4>

        <img src="images/tls-handshake.png">
    </section>

    <section>
        <h3><span class="red">R</span>EST</h3>
    </section>

    <section>
        <h4>REST</h4>

        <ul>
            <li class="left fragment">representational state transfer</li>
            <li class="left fragment">architecture for building web-applications</li>
            <li class="left fragment">semantics of request-response</li>
            <li class="left fragment">performance, durability, scalability</li>
            <li class="left fragment">RESTful-systems</li>
        </ul>
    </section>

    <section>
        <h4>REST - Basics</h4>

        <ul>
            <li class="left fragment">client-server architecture</li>
            <li class="left fragment">without state</li>
            <li class="left fragment">caching</li>
            <li class="left fragment">identifying resources via URL</li>
            <li class="left fragment">the query is self-describing</li>
            <li class="left fragment">changing state via requests</li>
        </ul>
    </section>

    <section>
        <h4>REST - Advantages</h4>

        <ul>
            <li class="left fragment">performance (caching)</li>
            <li class="left fragment">durability (stateless)</li>
            <li class="left fragment">scalability (stateless, simple interfaces, simple changing)</li>
        </ul>
    </section>

    <section>
        <h4>REST - Methods</h4>

        <ul>
            <li class="left fragment">GET - read the resource/collection</li>
            <li class="left fragment">PUT - update existed resource</li>
            <li class="left fragment">DELETE - delete existed resource</li>
            <li class="left fragment">POST - create resource + all other actions</li>
        </ul>
    </section>

    <section>
        <h4>REST - Naming</h4>

        <ul>
            <li class="left fragment">identifiers instead of query</li>
            <li class="left fragment">+: /users/12345</li>
            <li class="left fragment">-: /api?type=user&id=23</li>
            <li class="left fragment">-: /users?id=23</li>
        </ul>
    </section>

    <section>
        <h4>REST - Naming</h4>

        <ul>
            <li class="left fragment">hierarchy</li>
            <li class="left fragment">GET /users/12345/comments</li>
            <li class="left fragment">do not use deep nesting</li>
            <li class="left fragment">2-3 is optimal</li>
        </ul>
    </section>

    <section>
        <h4>REST - Naming</h4>

        <ul>
            <li class="left fragment">use nouns</li>
            <li class="left fragment">avoid verbs</li>
            <li class="left fragment">+: POST /users</li>
            <li class="left fragment">-: POST /users/update</li>
        </ul>
    </section>

    <section>
        <h4>REST - Naming</h4>

        <ul>
            <li class="left fragment">use plurals</li>
            <li class="left fragment">+: GET /customers/33245/orders/8769</li>
            <li class="left fragment">-: GET /customer/33245/order/8769</li>
        </ul>
    </section>

    <section>
        <h4>REST - Naming</h4>

        <ul>
            <li class="left fragment">use kebab-case</li>
            <li class="left fragment">+: GET /customers/33245/delivery-addresses</li>
            <li class="left fragment">-: GET /customers/33245/deliveryAddresses</li>
        </ul>
    </section>

    <section>
        <h4>REST - Naming</h4>

        <ul>
            <li class="left fragment">do not specify collections</li>
            <li class="left fragment">+: GET /customers</li>
            <li class="left fragment">-: GET /customer-list</li>
        </ul>
    </section>

    <section>
        <h4>REST - Status</h4>

        <ul>
            <li class="left fragment">use HTTP statuses for responses</li>
            <li class="left fragment">200, 201, 204, 400, 401, 403, 404, 405, 409, 500</li>
        </ul>
    </section>

    <section>
        <h4>REST - Formats</h4>

        <ul>
            <li class="left">recommend to support json and xml</li>
        </ul>
    </section>

    <section>
        <h4>REST - Versioning</h4>

        <ul>
            <li class="left fragment">Version of API like a part of the URL</li>
            <li class="left fragment">version of API - int number</li>
            <li class="left fragment">GET /api/v1/users</li>
        </ul>
    </section>

    <section>
        <h4>REST - Response</h4>

        <pre class="javascript"><code>
// +
"tags": [
  {"id": "125", "name": "Environment"},
  {"id": "834", "name": "Water Quality"}
]
    </code></pre>

        <pre class="javascript"><code>
// -
"tags": [
  {"125": "Environment"},
  {"834": "Water Quality"}
]
    </code></pre>
    </section>

    <section>
        <h4>REST - Pagination</h4>

        <ul>
            <li class="left fragment">limit by default</li>
            <li class="left fragment">information about pagination</li>
            <li class="left fragment">GET /api/v1/users?limit=25&offset=50</li>
        </ul>

        <pre class="javascript fragment"><code>
{
    "metadata": {
      "count": 308,
      "offset": 50,
      "limit": 25
    },
    "users": [ ... ]
}
    </code></pre>
    </section>

    <section>
        <h4>REST - Sorting, filtering</h4>

        <pre class="javascript"><code>
GET /users?sort=last_name|first_name|-hire_date
GET /users?filter=name::todd|city::denver
    </code></pre>
    </section>

    <section>
        <h4>REST - Errors</h4>

        <pre class="javascript"><code>
{
  "message": "The Error",
  "code": "server-error",
  "status": 500,

  // optional
  "developerMessage": "Hi developer!",
  "moreInfo": "http://example.com/server-error"
}
    </code></pre>
    </section>

    <section>
        <h4>REST - Headers</h4>

        <ul>
            <li class="left fragment">Content-Type, Accept</li>
            <li class="left fragment">Cache-Control, Expires, ETag for GET</li>
        </ul>
    </section>

    <section>
        <h4>REST - Examples</h4>

        <ul>
            <li class="left fragment"><a href="https://developer.github.com/v3/" target="_blank">Github</a></li>
            <li class="left fragment"><a href="https://www.twilio.com/docs/api" target="_blank">Twilio</a></li>
            <li class="left fragment"><a href="https://www.instagram.com/developer/endpoints/" target="_blank">Instagram</a></li>
        </ul>
    </section>

    <section>
        <h4>REST - Examples</h4>

        <ul>
            <li class="left fragment">/api/sessions - GET, POST, DELETE</li>
            <li class="left fragment">/api/users/{login}/password - PUT</li>
            <li class="left fragment">/api/users/{login}/tokens - DELETE</li>
            <li class="left fragment">/api/alerts/{id}/activation - GET/POST</li>
            <li class="left fragment">/api/alerts/{id}/cancellation - GET/POST</li>
        </ul>
    </section>

    <section>
        <h4>REST - Examples</h4>

        <ul>
            <li class="left fragment">GET /media/{media-id}</li>
            <li class="left fragment">GET /media/search?lat=48.858844&lng=2.294351</li>
            <li class="left fragment">GET /media/{media-id}/likes</li>
            <li class="left fragment">POST /media/{media-id}/likes</li>
            <li class="left fragment">DELETE /media/{media-id}/likes</li>
        </ul>
    </section>

    <section>
        <h3>Q&A</h3>
    </section>

</div></div>

<script src="../lib/js/head.min.js"></script>
<script src="../js/reveal.js"></script>
<script>
    Reveal.initialize({
        controls: false,
        progress: true,
        slideNumber: true,
        history: true,
        center: true,
        hideAddressBar: true,
        transition: 'slide',
        dependencies: [
            {
                src: '../plugin/highlight/highlight.js',
                async: true,
                condition: function () {
                    return Boolean(document.querySelector('pre code'));
                },
                callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });

    const body = document.getElementsByClassName('yandex')[0];
    let invert = false;

    body.onkeypress = function (event) {
        if (event.key.toLowerCase() !== 'i') return;

        if (invert) body.style = '';
        else body.style = 'filter: invert(100%)';

        invert = !invert;
    }
</script>
</body>
</html>